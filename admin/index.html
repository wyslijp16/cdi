<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDI Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            padding-top: 50px;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        body.dark .pending-card,
        body.dark .resource-card,
        body.dark .category-config-card,
        body.dark .login-form-card,
        body.dark #welcome-section,
        body.dark .modal-content {
            background-color: #2d3748;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.12);
        }
        body.dark .pending-card h3,
        body.dark .resource-card h3,
        body.dark .category-config-card h3 {
            color: #90cdf4;
        }
        body.dark .pending-card p,
        body.dark .resource-card p,
        body.dark .category-config-card p {
            color: #cbd5e0;
        }
        body.dark .modal-form-group label {
            color: #e2e8f0;
        }
        body.dark .modal-form-group input,
        body.dark .modal-form-group textarea,
        body.dark .modal-form-group select {
            background-color: #4a5568;
            border-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark .modal-form-group input:focus,
        body.dark .modal-form-group textarea:focus,
        body.dark .modal-form-group select:focus {
            border-color: #90cdf4;
        }
        body.dark .modal-buttons .btn-cancel {
            background-color: #4a5568;
        }
        body.dark .modal-buttons .btn-cancel:hover {
            background-color: #636b76;
        }
        body.dark #unauthorized-message {
            background-color: #372a2a;
            color: #fca5a5;
        }
        body.dark .filter-property-item {
            background-color: #4a5568;
            border-color: #4a5568;
        }
        body.dark .login-form-card h2,
        body.dark #welcome-section h2,
        body.dark main h1,
        body.dark #admin-panel-container h2 {
            color: #90cdf4;
        }
        body.dark #welcome-section p {
            color: #cbd5e0;
        }
        body.dark #sidebar-menu {
            background-color: #2d3748;
        }
        body.dark .menu-button:hover {
            background-color: #4a5568;
        }
        body.dark .menu-button.active-section-button {
            background-color: #4a5568;
        }
        body.dark .menu-button {
            color: #e2e8f0;
        }

        /* Styles pour le bouton burger */
        #hamburger-button {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 10001;
            background-color: #4338ca;
            color: white;
            padding: 0.75rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: background-color 0.2s;
        }
        #hamburger-button:hover {
            background-color: #3730a3;
        }
        /* Styles pour le menu lat√©ral */
        #sidebar-menu {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 256px;
            background-color: #3730a3;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 10000;
            padding: 1rem;
            padding-top: 5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        #sidebar-menu.open {
            transform: translateX(0);
        }
        .menu-button {
            text-align: left;
            font-weight: 600;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            background-color: transparent;
            color: white;
            transition: background-color 0.2s;
            width: 100%;
        }
        .menu-button:hover {
            background-color: #4338ca;
        }
        .menu-button.active-section-button {
            background-color: #4338ca;
        }
        main {
            padding-left: 1rem;
            transition: padding-left 0.3s ease-in-out;
        }
        .pending-card, .resource-card, .category-config-card {
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .pending-card.fade-out, .resource-card.fade-out, .category-config-card.fade-out {
            opacity: 0;
            transform: translateY(-20px);
        }
        .pending-card h3, .resource-card h3, .category-config-card h3 {
            font-weight: 600;
            color: #4338ca;
            font-size: 1.25rem;
        }
        .pending-card p, .resource-card p, .category-config-card p {
            color: #4b5563;
        }
        .pending-card .actions, .resource-card .actions, .category-config-card .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .pending-card .actions button, .resource-card .actions button, .category-config-card .actions button {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            color: white;
            transition: background-color 0.2s;
        }
        .pending-card .actions .btn-validate, .resource-card .actions .btn-edit, .category-config-card .actions .btn-edit-category {
            background-color: #10b981;
        }
        .pending-card .actions .btn-validate:hover, .resource-card .actions .btn-edit:hover, .category-config-card .actions .btn-edit-category:hover {
            background-color: #059669;
        }
        .pending-card .actions .btn-reject, .resource-card .actions .btn-delete, .category-config-card .actions .btn-delete-category {
            background-color: #ef4444;
        }
        .pending-card .actions .btn-reject:hover, .resource-card .actions .btn-delete:hover, .category-config-card .actions .btn-delete-category:hover {
            background-color: #dc2626;
        }
        .card-message-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease-in;
            pointer-events: none;
            z-index: 10;
        }
        .card-message-area.show {
            opacity: 1;
        }
        .card-message-area.success {
            background-color: rgba(16, 185, 129, 0.9);
        }
        .card-message-area.error {
            background-color: rgba(239, 68, 68, 0.9);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease-out;
            visibility: hidden;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease-out;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4b5563;
        }
        .modal-close-button:hover {
            color: #1f2937;
        }
        .modal-form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }
        .modal-form-group input, .modal-form-group textarea, .modal-form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            transition: border-color 0.2s;
        }
        .modal-form-group input:focus, .modal-form-group textarea:focus, .modal-form-group select:focus {
            outline: none;
            border-color: #4338ca;
        }
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .modal-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: white;
            transition: background-color 0.2s;
        }
        .modal-buttons .btn-save {
            background-color: #2563eb;
        }
        .modal-buttons .btn-save:hover {
            background-color: #1d4ed8;
        }
        .modal-buttons .btn-cancel {
            background-color: #6b7280;
        }
        .modal-buttons .btn-cancel:hover {
            background-color: #4b5563;
        }
        .modal-buttons .btn-delete-resource {
            background-color: #ef4444;
            margin-right: auto;
        }
        .modal-buttons .btn-delete-resource:hover {
            background-color: #dc2626;
        }
        .filter-property-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: #f9fafb;
            padding: 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid #e5e7eb;
        }
        .filter-property-item input {
            flex-grow: 1;
            margin-bottom: 0 !important;
        }
        .filter-property-item button {
            background-color: #dc2626;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            font-weight: normal;
        }
        .login-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 1rem;
        }
        .login-form-card {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 400px;
            width: 100%;
        }
        #unauthorized-message {
            display: none;
            color: #ef4444;
            background-color: #fee2e2;
            padding: 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-align: center;
            max-width: 600px;
            margin: 2rem auto;
        }
        #dark-mode-toggle {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 1001;
            background-color: #4338ca;
            color: white;
            padding: 0.75rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: background-color 0.2s;
        }
        #dark-mode-toggle:hover {
            background-color: #3730a3;
        }
    </style>
</head>
<body class="text-gray-800">
    <button id="dark-mode-toggle" aria-label="Toggle dark mode">
        <i class="fas fa-moon"></i>
    </button>
    <div id="login-container" class="login-container">
        <div class="login-form-card">
            <h2 class="text-2xl font-bold text-center mb-6 text-indigo-700">Connexion au Panel Admin</h2>
            <form id="login-form">
                <div class="modal-form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="modal-form-group">
                    <label for="login-password">Mot de passe</label>
                    <input type="password" id="login-password" required>
                </div>
                <div id="login-message-area" class="text-center p-3 rounded-lg mb-4 hidden"></div>
                <button type="submit" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-md hover:bg-indigo-700 transition">Se connecter</button>
            </form>
        </div>
    </div>
    <div id="unauthorized-message" class="hidden">
        Acc√®s refus√©. Vos privil√®ges sont insuffisants pour acc√©der √† cette page.
    </div>
    <div id="admin-panel-container" class="hidden">
        <button id="hamburger-button">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
        <nav id="sidebar-menu">
            <div class="flex items-center space-x-4 mb-4">
                <div class="text-right text-sm">
                    <p class="font-bold text-lg" id="user-role-menu"></p>
                    <p class="text-gray-300" id="user-email-menu"></p>
                </div>
            </div>
            <button id="menu-btn-show-welcome" class="menu-button">Accueil</button>
            <button id="menu-btn-show-pending" class="menu-button">Propositions en attente</button>
            <div id="superuser-menu-items" class="hidden">
                <button id="menu-btn-show-manage" class="menu-button">G√©rer les ressources existantes</button>
                <button id="menu-btn-show-config" class="menu-button">G√©rer Cat√©gories/Filtres</button>
            </div>
            <div class="mt-auto pt-4 border-t border-indigo-600">
                 <button id="change-password-btn" class="menu-button">Changer le mot de passe</button>
                <button id="logout-btn" class="menu-button bg-red-500 hover:bg-red-600 mt-2">D√©connexion</button>
            </div>
        </nav>
        <main class="container mx-auto p-4 md:p-8">
            <h1 class="text-3xl font-bold text-center mb-8 text-indigo-700">Panneau d'Administration CDI</h1>
            <div id="general-message-area" class="text-center p-3 rounded-lg mb-4 hidden"></div>

            <div id="welcome-section" class="text-center bg-white p-8 rounded-lg shadow-md max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold text-indigo-700 mb-4">Bienvenue sur le Panneau d'Administration du CDI !</h2>
                <p class="text-lg text-gray-700 mb-4">
                    Utilisez ce panneau pour g√©rer les ressources du Centre de Documentation et d'Information de L'√©kip Teknik.
                </p>
                <p class="text-md text-gray-600">
                    S√©lectionnez une option dans le menu lat√©ral (cliquez sur l'ic√¥ne <svg class="inline-block w-5 h-5 align-middle" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg> en haut √† gauche) pour commencer. Vous pourrez valider ou refuser les **propositions en attente**, modifier ou supprimer les **ressources existantes**, et g√©rer les **cat√©gories et leurs propri√©t√©s de filtre**.
                </p>
            </div>

            <div id="pending-suggestions-section" class="hidden">
                <h2 class="text-2xl font-bold text-center mb-6">Propositions en attente de validation</h2>
                <div id="pending-suggestions-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <p class="col-span-full text-center text-gray-500 text-xl mt-12">Chargement des propositions...</p>
                </div>
            </div>

            <div id="manage-resources-section" class="hidden">
                <h2 class="text-2xl font-bold text-center mb-6">G√©rer les ressources existantes</h2>
                <div id="resources-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <p class="col-span-full text-center text-gray-500 text-xl mt-12">Chargement des ressources...</p>
                </div>
            </div>

            <div id="category-config-section" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">G√©rer les cat√©gories et filtres</h2>
                    <button id="add-category-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition-colors">Ajouter une cat√©gorie</button>
                </div>
                <div id="category-config-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <p class="col-span-full text-center text-gray-500 text-xl mt-12">Chargement de la configuration...</p>
                </div>
            </div>

            <div id="password-change-section" class="hidden">
                <h2 class="text-2xl font-bold text-center mb-6">Changer le mot de passe</h2>
                <form id="password-change-form" class="bg-white p-8 rounded-lg shadow-md max-w-xl mx-auto">
                    <div class="modal-form-group">
                        <label for="current-password">Mot de passe actuel</label>
                        <input type="password" id="current-password" required>
                    </div>
                    <div class="modal-form-group">
                        <label for="new-password">Nouveau mot de passe</label>
                        <input type="password" id="new-password" required>
                    </div>
                    <div class="modal-form-group">
                        <label for="confirm-password">Confirmer le nouveau mot de passe</label>
                        <input type="password" id="confirm-password" required>
                    </div>
                    <div id="password-change-message-area" class="text-center p-3 rounded-lg mb-4 hidden"></div>
                    <button type="submit" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-md hover:bg-indigo-700 transition">Changer le mot de passe</button>
                </form>
            </div>
        </main>
    </div>

    <!-- Modal pour √©diter/ajouter une ressource -->
    <div id="edit-resource-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-button">&times;</button>
            <h2 id="edit-modal-title" class="text-2xl font-bold mb-4"></h2>
            <form id="edit-resource-form">
                <div class="modal-form-group">
                    <label for="edit-title">Titre</label>
                    <input type="text" id="edit-title" required>
                </div>
                <div class="modal-form-group">
                    <label for="edit-description">Description</label>
                    <textarea id="edit-description" rows="4" required></textarea>
                </div>
                <div class="modal-form-group">
                    <label for="edit-url">Lien (URL)</label>
                    <input type="url" id="edit-url" required>
                </div>
                <div class="modal-form-group">
                    <label for="edit-category">Cat√©gorie</label>
                    <select id="edit-category" required></select>
                </div>
                <div id="edit-filters-container"></div>
                <div class="modal-buttons">
                    <button type="button" id="delete-resource-btn" class="btn-delete-resource">Supprimer</button>
                    <button type="submit" class="btn-save">Sauvegarder</button>
                    <button type="button" class="btn-cancel">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour √©diter/ajouter une cat√©gorie -->
    <div id="edit-category-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-button">&times;</button>
            <h2 id="edit-category-modal-title" class="text-2xl font-bold mb-4"></h2>
            <form id="edit-category-form">
                <div class="modal-form-group">
                    <label for="edit-category-name">Nom de la cat√©gorie</label>
                    <input type="text" id="edit-category-name" required>
                </div>
                <div class="modal-form-group">
                    <label for="edit-category-key">Cl√© unique (ID)</label>
                    <input type="text" id="edit-category-key" required>
                </div>
                <h3 class="font-bold text-lg mb-2 mt-4">Propri√©t√©s de filtre</h3>
                <div id="filter-properties-list"></div>
                <button type="button" id="add-filter-property-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-full mt-2 transition-colors">Ajouter une propri√©t√©</button>
                <div class="modal-buttons">
                    <button type="submit" class="btn-save">Sauvegarder</button>
                    <button type="button" class="btn-cancel">Annuler</button>
                </div>
            </form>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword, updatePassword, reauthenticateWithCredential, EmailAuthProvider } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, query, where, onSnapshot, getDocs, setDoc, updateDoc, deleteDoc, serverTimestamp, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration (remplacez par votre propre configuration)
        const firebaseConfig = {
          apiKey: "AIzaSyAKoEX-Sdn1KQ78wYZCAz001vKiRBoT46w",
          authDomain: "cdi-lfi.firebaseapp.com",
          projectId: "cdi-lfi",
          storageBucket: "cdi-lfi.firebasestorage.app",
          messagingSenderId: "626855610699",
          appId: "1:626855610699:web:3c46a96f9d77d3e150c0ce",
          measurementId: "G-EMXFSRL9W0"
        };
        
        // Initialisation de Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // El√©ments de l'interface
        const loginContainer = document.getElementById('login-container');
        const loginForm = document.getElementById('login-form');
        const loginMessageArea = document.getElementById('login-message-area');
        const unauthorizedMessage = document.getElementById('unauthorized-message');
        const adminPanelContainer = document.getElementById('admin-panel-container');
        const welcomeSection = document.getElementById('welcome-section');
        const pendingSuggestionsSection = document.getElementById('pending-suggestions-section');
        const manageResourcesSection = document.getElementById('manage-resources-section');
        const categoryConfigSection = document.getElementById('category-config-section');
        const passwordChangeSection = document.getElementById('password-change-section');
        const pendingSuggestionsList = document.getElementById('pending-suggestions-list');
        const resourcesList = document.getElementById('resources-list');
        const categoryConfigList = document.getElementById('category-config-list');
        const generalMessageArea = document.getElementById('general-message-area');
        const hamburgerButton = document.getElementById('hamburger-button');
        const sidebarMenu = document.getElementById('sidebar-menu');
        const menuButtons = document.querySelectorAll('#sidebar-menu .menu-button');
        const superuserMenuItems = document.getElementById('superuser-menu-items');
        const userRoleMenu = document.getElementById('user-role-menu');
        const userEmailMenu = document.getElementById('user-email-menu');

        // Modals et formulaires d'√©dition
        const editResourceModalOverlay = document.getElementById('edit-resource-modal-overlay');
        const editResourceForm = document.getElementById('edit-resource-form');
        const editModalTitle = document.getElementById('edit-modal-title');
        const editTitleInput = document.getElementById('edit-title');
        const editDescriptionInput = document.getElementById('edit-description');
        const editUrlInput = document.getElementById('edit-url');
        const editCategorySelect = document.getElementById('edit-category');
        const editFiltersContainer = document.getElementById('edit-filters-container');
        const deleteResourceBtn = document.getElementById('delete-resource-btn');
        let currentEditingResourceId = null;
        let currentEditingResourceData = null;

        const editCategoryModalOverlay = document.getElementById('edit-category-modal-overlay');
        const editCategoryForm = document.getElementById('edit-category-form');
        const editCategoryModalTitle = document.getElementById('edit-category-modal-title');
        const editCategoryNameInput = document.getElementById('edit-category-name');
        const editCategoryKeyInput = document.getElementById('edit-category-key');
        const addFilterPropertyBtn = document.getElementById('add-filter-property-btn');
        const filterPropertiesList = document.getElementById('filter-properties-list');
        let currentEditingCategoryKey = null;

        // Formulaire de changement de mot de passe
        const passwordChangeForm = document.getElementById('password-change-form');
        const currentPasswordInput = document.getElementById('current-password');
        const newPasswordInput = document.getElementById('new-password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const passwordChangeMessageArea = document.getElementById('password-change-message-area');

        // Variables globales
        let userRole = 'viewer';
        let categoryConfigData = {};
        let allResources = [];
        let allPendingSuggestions = [];

        // Gestion du mode sombre
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const body = document.body;
        const icon = darkModeToggle.querySelector('i');

        darkModeToggle.addEventListener('click', () => {
            body.classList.toggle('dark');
            const isDarkMode = body.classList.contains('dark');
            localStorage.setItem('darkMode', isDarkMode);
            if (isDarkMode) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        });

        // Appliquer le mode sombre au chargement
        if (localStorage.getItem('darkMode') === 'true') {
            body.classList.add('dark');
            icon.classList.remove('fa-moon');
            icon.classList.add('fa-sun');
        }

        // Fonction pour afficher des messages temporaires dans la zone g√©n√©rale
        function showGeneralMessage(message, type) {
            generalMessageArea.textContent = message;
            generalMessageArea.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800');
            if (type === 'success') {
                generalMessageArea.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                generalMessageArea.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'warning') {
                generalMessageArea.classList.add('bg-yellow-100', 'text-yellow-800');
            }
            setTimeout(() => {
                generalMessageArea.classList.add('hidden');
            }, 5000);
        }

        // Fonction pour afficher une section
        function showSection(sectionId) {
            const sections = {
                welcome: welcomeSection,
                pending: pendingSuggestionsSection,
                manage: manageResourcesSection,
                config: categoryConfigSection,
                password: passwordChangeSection,
            };

            Object.values(sections).forEach(section => section.classList.add('hidden'));
            if (sections[sectionId]) {
                sections[sectionId].classList.remove('hidden');
            }

            // Mettre √† jour le bouton de menu actif
            menuButtons.forEach(btn => btn.classList.remove('active-section-button'));
            const activeBtn = document.getElementById(`menu-btn-show-${sectionId}`);
            if (activeBtn) {
                activeBtn.classList.add('active-section-button');
            }
            
            // Re-render la section si n√©cessaire
            if (sectionId === 'pending') {
                renderPendingSuggestions(allPendingSuggestions);
            } else if (sectionId === 'manage') {
                renderResources(allResources);
            } else if (sectionId === 'config') {
                renderCategoryConfig();
            }
        }
        
        // ... (Le reste du code reste le m√™me, seules les sections de style et de gestion du mode sombre ont √©t√© ajout√©es)

        // Initialisation de l'application
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    const docRef = doc(db, "users", user.uid);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists() && docSnap.data().role) {
                        userRole = docSnap.data().role;
                    } else {
                        userRole = 'viewer';
                    }

                    loginContainer.classList.add('hidden');
                    unauthorizedMessage.classList.add('hidden');
                    adminPanelContainer.classList.remove('hidden');
                    
                    // Remplir les infos utilisateur dans le menu
                    userRoleMenu.textContent = userRole.charAt(0).toUpperCase() + userRole.slice(1);
                    userEmailMenu.textContent = user.email;

                    if (userRole === 'superuser') {
                        superuserMenuItems.classList.remove('hidden');
                    } else {
                        superuserMenuItems.classList.add('hidden');
                    }

                    // Charger les donn√©es de la base
                    await loadCategoryConfig();
                    listenToPendingSuggestions();
                    listenToResources();

                    // Afficher la section d'accueil
                    showSection('welcome');
                } catch (e) {
                    console.error("Error fetching user data: ", e);
                    // Si une erreur se produit, d√©connecter l'utilisateur
                    await signOut(auth);
                }
            } else {
                // Utilisateur d√©connect√©
                loginContainer.classList.remove('hidden');
                unauthorizedMessage.classList.add('hidden');
                adminPanelContainer.classList.add('hidden');
                // R√©initialiser le r√¥le
                userRole = 'viewer';
            }
        });

        // Event Listeners for sections
        document.getElementById('menu-btn-show-welcome').addEventListener('click', () => showSection('welcome'));
        document.getElementById('menu-btn-show-pending').addEventListener('click', () => showSection('pending'));
        document.getElementById('menu-btn-show-manage').addEventListener('click', () => showSection('manage'));
        document.getElementById('menu-btn-show-config').addEventListener('click', () => showSection('config'));
        document.getElementById('change-password-btn').addEventListener('click', () => showSection('password'));
        document.getElementById('logout-btn').addEventListener('click', async () => {
            await signOut(auth);
        });

        // Hamburger menu toggle
        hamburgerButton.addEventListener('click', () => {
            sidebarMenu.classList.toggle('open');
        });
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (!sidebarMenu.contains(e.target) && !hamburgerButton.contains(e.target) && sidebarMenu.classList.contains('open')) {
                sidebarMenu.classList.remove('open');
            }
        });

        // Other event listeners and functions (login, password change, modals, etc.) would go here
        
        // Login form submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = loginForm['login-email'].value;
            const password = loginForm['login-password'].value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                loginMessageArea.classList.add('hidden');
            } catch (error) {
                const errorMessage = error.message;
                loginMessageArea.textContent = "Erreur de connexion : email ou mot de passe incorrect.";
                loginMessageArea.classList.remove('hidden');
                loginMessageArea.classList.add('bg-red-100', 'text-red-800');
                console.error("Login error:", errorMessage);
            }
        });

        // Fonctions de rendu et de gestion des donn√©es (fonctions non modifi√©es, √† int√©grer)
        // ... listenToPendingSuggestions(), listenToResources(), renderPendingSuggestions(), renderResources(), etc. ...
    </script>
</body>
</html>
