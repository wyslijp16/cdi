<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDI de L'ékip Teknik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            padding-top: 100px;
        }
        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .active-button {
            background-color: #4338ca;
        }
        .floating-header {
            position: fixed;
            top: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            min-width: 590px;
            max-width: 90%;
            text-align: center;
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-indigo-700 text-white p-5 shadow-lg rounded-full floating-header transition-all duration-300 ease-in-out">
        <h1 class="text-2xl font-bold">CDI de L'ékip Teknik</h1>
        <p class="mt-2 text-base font-light hidden md:block">Le centre de ressources pour les militantes et militants de LFI</p>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <div class="flex flex-wrap justify-center gap-4 mb-8">
            <button id="btn-petitions" class="btn bg-indigo-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-indigo-700 transition-colors">Pétitions</button>
            <button id="btn-comptes-utiles" class="btn bg-indigo-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-indigo-700 transition-colors">Comptes utiles</button>
            <button id="btn-sites-utiles" class="btn bg-indigo-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-indigo-700 transition-colors">Sites utiles</button>
            <button id="btn-ouvrages" class="btn bg-indigo-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-indigo-700 transition-colors">Ouvrages</button>
            <button id="btn-proposer" class="bg-emerald-500 text-white font-semibold py-3 px-6 rounded-full shadow-lg hover:bg-emerald-600 transition-colors">Proposer une ressource</button>
        </div>

        <!-- Zone d'affichage des messages (succès/erreur) -->
        <div id="message-area" class="text-center p-3 rounded-lg mb-4 hidden"></div>

        <div id="controls-container" class="hidden">
            <div id="search-container" class="mb-4">
                <input type="text" id="search-input" placeholder="Rechercher..." class="w-full p-3 rounded-full border-2 border-gray-300 focus:outline-none focus:border-indigo-500 transition-colors">
            </div>

            <div id="filters-container" class="flex flex-wrap gap-4 mb-8">
            </div>
        </div>

        <!-- Formulaire de proposition de ressource (initialement caché) -->
        <div id="suggestion-form-container" class="hidden">
            <h2 class="text-2xl font-bold text-center mb-4">Proposer une nouvelle ressource</h2>
            <form id="suggestion-form" class="bg-white p-8 rounded-lg shadow-md max-w-xl mx-auto">
                <div class="mb-4">
                    <label for="suggestion-title" class="block text-gray-700 font-semibold mb-2">Titre</label>
                    <input type="text" id="suggestion-title" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500" required>
                </div>
                <div class="mb-4">
                    <label for="suggestion-description" class="block text-gray-700 font-semibold mb-2">Description</label>
                    <textarea id="suggestion-description" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500" rows="3" required></textarea>
                </div>
                <div class="mb-4">
                    <label for="suggestion-url" class="block text-gray-700 font-semibold mb-2">URL</label>
                    <input type="url" id="suggestion-url" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500" required>
                </div>
                <div class="mb-4">
                    <label for="suggestion-category" class="block text-gray-700 font-semibold mb-2">Catégorie</label>
                    <select id="suggestion-category" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500" required>
                        <option value="">Sélectionnez une catégorie</option>
                        <option value="petitions">Pétition</option>
                        <option value="comptes-utiles">Compte utile</option>
                        <option value="sites-utiles">Site utile</option>
                        <option value="ouvrages">Ouvrage</option>
                    </select>
                </div>
                <!-- Champs spécifiques à la catégorie (générés dynamiquement par JS) -->
                <div id="specific-fields" class="mb-4 hidden">
                </div>
                <button type="submit" class="w-full bg-emerald-500 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-emerald-600 transition-colors">Envoyer la proposition</button>
            </form>
        </div>


        <div id="content-container" class="grid grid-cols-1 gap-6">
            <div class="col-span-full text-center text-gray-500 text-xl mt-12">
                <p>Sélectionnez une catégorie ci-dessus pour afficher les ressources.</p>
                <p>Assurez-vous d'avoir des données dans votre collection 'resources' sur Firestore.</p>
            </div>
        </div>

    </main>

    <script type="module">
        // Importation des fonctions nécessaires depuis les SDK Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";

        // Votre configuration Firebase (remplacez par vos propres clés si elles changent)
        const firebaseConfig = {
            apiKey: "AIzaSyAKoEX-Sdn1KQ78wYZCAz001vKiRBoT46w",
            authDomain: "cdi-lfi.firebaseapp.com",
            projectId: "cdi-lfi",
            storageBucket: "cdi-lfi.firebasestorage.app",
            messagingSenderId: "626855610699",
            appId: "1:626855610699:web:3c46a96f9d77d3e150c0ce",
            measurementId: "G-EMXFSRL9W0"
        };

        // Initialisation de Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const analytics = getAnalytics(app); // Analytics est initialisé mais non utilisé activement dans ce script

        // Références aux éléments DOM
        const contentContainer = document.getElementById('content-container');
        const controlsContainer = document.getElementById('controls-container');
        const searchInput = document.getElementById('search-input');
        const filtersContainer = document.getElementById('filters-container');
        const categoryButtons = document.querySelectorAll('.btn');
        const proposeButton = document.getElementById('btn-proposer');
        const suggestionFormContainer = document.getElementById('suggestion-form-container');
        const suggestionForm = document.getElementById('suggestion-form');
        const suggestionCategorySelect = document.getElementById('suggestion-category');
        const specificFieldsContainer = document.getElementById('specific-fields');
        const messageArea = document.getElementById('message-area');

        let currentCategory = null;
        let unsubscribeSnapshot = null; // Stocke la fonction de désabonnement de l'écouteur Firestore

        // Définition des champs spécifiques pour chaque catégorie du formulaire de proposition
        const categorySpecificFields = {
            'petitions': [
                { id: 'suggestion-platform', label: 'Plateforme', type: 'text', placeholder: 'Ex: petitions.assemblee-nationale.fr' },
                { id: 'suggestion-struggle', label: 'Lutte', type: 'text', placeholder: 'Ex: Politique, Santé, Social' }
            ],
            'comptes-utiles': [
                { id: 'suggestion-network', label: 'Réseau', type: 'text', placeholder: 'Ex: Twitter, Facebook, YouTube' }
            ],
            'sites-utiles': [
                { id: 'suggestion-type', label: 'Type de site', type: 'text', placeholder: 'Ex: Site officiel, Blog personnel, Journal' }
            ],
            'ouvrages': [
                { id: 'suggestion-publisher', label: 'Éditeur', type: 'text', placeholder: 'Ex: Éditions du Seuil' }
            ]
        };

        /**
         * Affiche un message dans la zone de message.
         * @param {string} message - Le message à afficher.
         * @param {string} type - Le type de message ('success' ou 'error').
         */
        function showMessage(message, type) {
            messageArea.textContent = message;
            messageArea.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
            if (type === 'success') {
                messageArea.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                messageArea.classList.add('bg-red-100', 'text-red-800');
            }
            // Cache le message après 5 secondes
            setTimeout(() => {
                messageArea.classList.add('hidden');
            }, 5000);
        }

        /**
         * Crée un élément de carte HTML pour un élément donné.
         * @param {object} item - L'objet de données pour la carte.
         * @param {string[]} filterProperties - Un tableau de propriétés à utiliser pour les attributs de données et l'affichage.
         * @returns {HTMLAnchorElement} L'élément de carte créé.
         */
        function createCard(item, filterProperties) {
            const card = document.createElement('a');
            card.href = item.url;
            card.target = "_blank";
            card.className = "card block bg-white rounded-lg shadow-md flex p-6";

            filterProperties.forEach(prop => {
                if (item[prop]) {
                    card.setAttribute(`data-${prop}`, String(item[prop]).toLowerCase()); // S'assure de la conversion en chaîne
                }
            });

            const mainContent = document.createElement('div');
            mainContent.className = "flex-1 pr-4";
            mainContent.innerHTML = `
                <h3 class="text-xl font-semibold text-indigo-800 mb-2">${item.title}</h3>
                <p class="text-gray-600">${item.description}</p>
            `;
            card.appendChild(mainContent);

            const separator = document.createElement('div');
            separator.className = "w-px bg-gray-200 h-auto mx-4";
            card.appendChild(separator);

            const characteristics = document.createElement('div');
            characteristics.className = "w-1/4 min-w-max text-right text-sm text-gray-500 flex-none";
            const characteristicsHtml = filterProperties.filter(prop => item[prop]).map(prop => `
                <div>
                    <span class="font-medium">${prop.charAt(0).toUpperCase() + prop.slice(1)}</span> : ${item[prop]}
                </div>
            `).join('');
            characteristics.innerHTML = characteristicsHtml;
            card.appendChild(characteristics);
            
            return card;
        }

        /**
         * Rend le contenu pour une catégorie sélectionnée en récupérant les données de Firestore.
         * @param {string} categoryKey - La clé de la catégorie à rendre.
         */
        function renderCategory(categoryKey) {
            // Se désabonne de l'écouteur de snapshot précédent s'il existe
            if (unsubscribeSnapshot) {
                unsubscribeSnapshot();
            }

            // Cache le formulaire de proposition et la zone de message
            suggestionFormContainer.classList.add('hidden');
            messageArea.classList.add('hidden');

            contentContainer.innerHTML = '';
            filtersContainer.innerHTML = '';
            controlsContainer.classList.remove('hidden');
            contentContainer.classList.remove('hidden'); // S'assure que le conteneur de contenu est visible
            currentCategory = categoryKey;
            
            searchInput.value = '';

            // Crée une requête pour les ressources de la catégorie sélectionnée
            // Nous supposons que le champ 'category' existe dans les documents 'resources'
            const q = query(collection(db, "resources"), where("category", "==", categoryKey));

            // Écoute les changements en temps réel
            unsubscribeSnapshot = onSnapshot(q, (querySnapshot) => {
                const items = [];
                querySnapshot.forEach((doc) => {
                    items.push(doc.data());
                });

                // Efface le contenu et les filtres précédents avant de rendre les nouvelles données
                contentContainer.innerHTML = '';
                filtersContainer.innerHTML = '';

                if (items.length === 0) {
                    contentContainer.innerHTML = `<div class="col-span-full text-center text-gray-500 text-xl mt-12"><p>Aucune ressource trouvée pour cette catégorie. Ajoutez-en via la console Firebase !</p></div>`;
                    return;
                }

                // Détermine dynamiquement les propriétés filtrables à partir des éléments récupérés
                // Cela suppose que tous les éléments d'une catégorie auront une structure similaire
                const filterProperties = Object.keys(items[0]).filter(key => ['platform', 'struggle', 'network', 'type', 'publisher'].includes(key));
                
                filterProperties.forEach(prop => {
                    const uniqueFilters = [...new Set(items.map(item => item[prop]))].sort();
                    
                    const filterGroup = document.createElement('div');
                    filterGroup.className = 'flex flex-col';
                    
                    const filterLabel = document.createElement('label');
                    filterLabel.className = 'font-semibold text-gray-700 mb-1 text-sm';
                    filterLabel.textContent = prop.charAt(0).toUpperCase() + prop.slice(1);
                    filterGroup.appendChild(filterLabel);
                    
                    const filterSelect = document.createElement('select');
                    filterSelect.className = 'p-2 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500 transition-colors';
                    filterSelect.setAttribute('data-filter-property', prop);
                    filterSelect.addEventListener('change', filterContent);

                    const allOption = document.createElement('option');
                    allOption.value = 'all';
                    allOption.textContent = 'Tous';
                    filterSelect.appendChild(allOption);

                    uniqueFilters.forEach(filterValue => {
                        if (filterValue) { // Ajoute uniquement si la valeur existe
                            const option = document.createElement('option');
                            option.value = String(filterValue).toLowerCase();
                            option.textContent = filterValue;
                            filterSelect.appendChild(option);
                        }
                    });

                    filterGroup.appendChild(filterSelect);
                    filtersContainer.appendChild(filterGroup);
                });

                // Rend les cartes
                items.forEach(item => {
                    contentContainer.appendChild(createCard(item, filterProperties));
                });

                // Applique les filtres/recherche actuels après le rendu du nouveau contenu
                filterContent();
            }, (error) => {
                console.error("Error fetching resources: ", error);
                showMessage("Erreur lors du chargement des ressources. Veuillez vérifier votre connexion ou les règles de sécurité Firebase.", 'error');
            });
        }

        /**
         * Filtre les cartes de contenu affichées en fonction du terme de recherche et des filtres sélectionnés.
         */
        function filterContent() {
            const searchTerm = searchInput.value.toLowerCase();
            const cards = contentContainer.querySelectorAll('.card');
            const filterSelects = filtersContainer.querySelectorAll('select');
            
            cards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const description = card.querySelector('p').textContent.toLowerCase();
                
                const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
                
                let matchesFilters = true;
                filterSelects.forEach(select => {
                    const prop = select.getAttribute('data-filter-property');
                    const filterValue = select.value;

                    if (filterValue !== 'all') {
                        const cardFilterValue = card.getAttribute(`data-${prop}`);
                        if (!cardFilterValue || cardFilterValue !== filterValue) {
                            matchesFilters = false;
                        }
                    }
                });
                
                if (matchesSearch && matchesFilters) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        /**
         * Affiche le formulaire de proposition de ressource et masque les autres contenus.
         */
        function showProposeForm() {
            // Se désabonne de l'écouteur de snapshot précédent s'il existe
            if (unsubscribeSnapshot) {
                unsubscribeSnapshot();
            }

            // Désactive tous les boutons de catégorie
            categoryButtons.forEach(btn => btn.classList.remove('active-button'));
            // Cache le contenu principal et les contrôles
            controlsContainer.classList.add('hidden');
            contentContainer.classList.add('hidden');
            messageArea.classList.add('hidden'); // Cache tout message précédent
            
            // Affiche le formulaire de proposition
            suggestionFormContainer.classList.remove('hidden');
            suggestionForm.reset(); // Efface les champs du formulaire
            specificFieldsContainer.innerHTML = ''; // Efface les champs spécifiques
            specificFieldsContainer.classList.add('hidden'); // Cache les champs spécifiques
        }

        /**
         * Génère des champs de saisie spécifiques en fonction de la catégorie sélectionnée dans le formulaire de proposition.
         */
        function generateSpecificFields() {
            const selectedCategory = suggestionCategorySelect.value;
            specificFieldsContainer.innerHTML = ''; // Efface les champs précédents

            if (selectedCategory && categorySpecificFields[selectedCategory]) {
                categorySpecificFields[selectedCategory].forEach(field => {
                    const div = document.createElement('div');
                    div.className = 'mb-4';
                    div.innerHTML = `
                        <label for="${field.id}" class="block text-gray-700 font-semibold mb-2">${field.label}</label>
                        <input type="${field.type}" id="${field.id}" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-indigo-500" placeholder="${field.placeholder || ''}">
                    `;
                    specificFieldsContainer.appendChild(div);
                });
                specificFieldsContainer.classList.remove('hidden');
            } else {
                specificFieldsContainer.classList.add('hidden');
            }
        }

        /**
         * Gère la soumission du formulaire de proposition de ressource, en envoyant les données à Firestore.
         * @param {Event} event - L'événement de soumission du formulaire.
         */
        async function handleSuggestionSubmit(event) {
            event.preventDefault(); // Empêche la soumission par défaut du formulaire

            const title = document.getElementById('suggestion-title').value;
            const description = document.getElementById('suggestion-description').value;
            const url = document.getElementById('suggestion-url').value;
            const category = document.getElementById('suggestion-category').value;

            // Collecte les champs spécifiques en fonction de la catégorie sélectionnée
            const specificData = {};
            if (categorySpecificFields[category]) {
                categorySpecificFields[category].forEach(field => {
                    const inputElement = document.getElementById(field.id);
                    if (inputElement && inputElement.value) {
                        specificData[field.id.replace('suggestion-', '')] = inputElement.value;
                    }
                });
            }

            const newSuggestion = {
                title,
                description,
                url,
                category,
                ...specificData, // Ajoute les champs spécifiques
                createdAt: serverTimestamp(), // Ajoute un horodatage généré par le serveur
                status: 'pending' // Statut initial pour la révision
            };

            try {
                // Ajoute un nouveau document à la collection 'suggestions'
                await addDoc(collection(db, 'suggestions'), newSuggestion);
                showMessage('Votre proposition a été envoyée avec succès ! Elle sera examinée prochainement.', 'success');
                suggestionForm.reset(); // Efface les champs du formulaire
                specificFieldsContainer.innerHTML = ''; // Efface les champs spécifiques
                specificFieldsContainer.classList.add('hidden'); // Cache les champs spécifiques
            } catch (e) {
                console.error("Error adding document: ", e);
                showMessage("Une erreur s'est produite lors de l'envoi de la proposition. Veuillez réessayer.", 'error');
            }
        }

        // Écouteurs d'événements
        categoryButtons.forEach(button => {
            button.addEventListener('click', () => {
                categoryButtons.forEach(btn => btn.classList.remove('active-button'));
                button.classList.add('active-button');
                
                const categoryKey = button.id.replace('btn-', '');
                renderCategory(categoryKey);
            });
        });

        proposeButton.addEventListener('click', showProposeForm);
        searchInput.addEventListener('keyup', filterContent);
        suggestionForm.addEventListener('submit', handleSuggestionSubmit);
        suggestionCategorySelect.addEventListener('change', generateSpecificFields);

    </script>

    <!-- Script d'importation de données Firestore (à exécuter une seule fois) -->
    <script type="module">
        // Importation des fonctions nécessaires depuis les SDK Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Votre configuration Firebase (DOIT être la même que dans votre index.html)
        const firebaseConfig = {
            apiKey: "AIzaSyAKoEX-Sdn1KQ78wYZCAz001vKiRBoT46w",
            authDomain: "cdi-lfi.firebaseapp.com",
            projectId: "cdi-lfi",
            storageBucket: "cdi-lfi.firebasestorage.app",
            messagingSenderId: "626855610699",
            appId: "1:626855610699:web:3c46a96f9d77d3e150c0ce",
            measurementId: "G-EMXFSRL9W0"
        };

        // Initialisation de Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Vos données d'origine
        const contentData = {
            petitions: [
                { title: "Pétition pour la 6ème République", description: "Cette pétition vise à la convocation d'une Assemblée constituante pour la 6e République.", url: "https://petitions.assemblee-nationale.fr/initiatives/i-2793", platform: "petitions.assemblee-nationale.fr", struggle: "Politique" },
                { title: "Non à la Loi Duplomb — Pour la santé, la sécurité, l’intelligence collective.", description: "La Loi Duplomb est une aberration scientifique, éthique, environnementale et sanitaire. Elle représente une attaque frontale contre la santé publique, la biodiversité, la cohérence des politiques climatiques, la sécurité alimentaire, et le bon sens.", url: "https://petitions.assemblee-nationale.fr/initiatives/i-3014", platform: "petitions.assemblee-nationale.fr", struggle: "Santé" },
                { title: "Budget : les sacrifices pour le monde du travail ça suffit !", description: "Pas question que ce soient encore les travailleuses et travailleurs, les demandeurs d’emploi, les jeunes et les retraité·es qui payent la facture, à la fois financièrement, mais aussi dans une flexibilité encore intensifiée !", url: "https://www.change.org/p/budget-les-sacrifices-pour-le-monde-du-travail-%C3%A7a-suffit", platform: "Change.org", struggle: "Social" },
            ],
            "comptes-utiles": [
                { title: "La France insoumise", description: "Le compte officiel du mouvement sur X (Twitter).", url: "https://twitter.com/FranceInsoumise", network: "Twitter" },
                { title: "Jean-Luc Mélenchon", description: "Le compte personnel de Jean-Luc Mélenchon sur X.", url: "https://twitter.com/JLMelenchon", network: "Twitter" },
                { title: "LFI sur Facebook", description: "Suivez l'actualité du mouvement sur la page officielle.", url: "https://www.facebook.com/lafranceinsoumise", network: "Facebook" },
                { title: "Le Média TV", description: "La chaîne YouTube pour des analyses et des reportages engagés.", url: "https://www.youtube.com/@lemediatv", network: "YouTube" },
                { title: "Avenir en Commun", description: "La page Facebook pour l'actualité et les événements du programme.", url: "https://www.facebook.com/avenir.en.commun", network: "Facebook" },
            ],
            "sites-utiles": [
                { title: "Le site officiel de LFI", description: "Accédez à toutes les informations, aux programmes et aux actualités.", url: "https://lafranceinsoumise.fr", type: "Site officiel" },
                { title: "Le Blog de Jean-Luc Mélenchon", description: "Retrouvez les analyses et les tribunes du leader de LFI.", url: "https://melenchon.fr", type: "Blog personnel" },
                { title: "L'insoumission.fr", description: "Le journal des insoumis pour une information alternative.", url: "https://linsoumission.fr", type: "Journal" },
                { title: "Programme l'Avenir en Commun", description: "Consultez le programme pour l'élection présidentielle de 2022.", url: "https://lafranceinsoumise.fr/programme/", type: "Programme officiel" },
                { title: "Mediapart", description: "Média d'investigation indépendant.", url: "https://www.mediapart.fr", type: "Journal" }
            ],
            ouvrages: [
                { title: "L'Ère du peuple", description: "Livre de Jean-Luc Mélenchon analysant la crise politique actuelle.", url: "https://www.placedeslibraires.fr/livre/9782749925327-l-ere-du-peuple-jean-luc-melenchon/", publisher: "Éditions du Seuil" },
                { title: "Révolution", description: "Le programme complet de LFI pour la transformation de la société française.", url: "https://lafranceinsoumise.fr/programme/", publisher: "Éditions du Détour" },
                { title: "Le Choix de l'insoumission", description: "Un recueil d'articles et d'analyses pour comprendre le mouvement.", url: "https://www.amazon.fr/choix-linsoumission-Jean-Luc-Melenchon/dp/2377221379", publisher: "Éditions du Seuil" },
                { title: "La Gauche des faits", description: "Un ouvrage collectif pour déconstruire les mythes de l'économie néolibérale.", url: "https://www.placedeslibraires.fr/livre/9782707198188-la-gauche-des-faits-collectif/", publisher: "La Découverte" },
                { title: "L'insurrection qui vient", description: "Réflexion sur la crise de la modernité et les formes de résistance.", url: "https://www.placedeslibraires.fr/livre/9782020986961-l-insurrection-qui-vient-comite-invisible/", publisher: "La Fabrique" },
                { title: "Pour un matérialisme historique", description: "Essai de Louis Althusser sur la théorie marxiste.", url: "https://www.placedeslibraires.fr/livre/9782707153675-pour-un-materialisme-historique-louis-althusser/", publisher: "La Découverte" }
            ]
        };

        /**
         * Fonction pour importer les données dans Firestore.
         * Cette fonction ne doit être exécutée qu'UNE SEULE FOIS pour éviter les doublons.
         */
        async function importDataToFirestore() {
            console.log("Début de l'importation des données dans Firestore...");
            let successCount = 0;
            let errorCount = 0;

            for (const categoryKey in contentData) {
                if (contentData.hasOwnProperty(categoryKey)) {
                    const items = contentData[categoryKey];
                    for (const item of items) {
                        // Ajoute le champ 'category' à chaque élément pour le filtrage Firestore
                        const itemToSave = { ...item, category: categoryKey };
                        try {
                            await addDoc(collection(db, 'resources'), itemToSave);
                            console.log(`Document ajouté à 'resources' pour la catégorie '${categoryKey}':`, item.title);
                            successCount++;
                        } catch (e) {
                            console.error(`Erreur lors de l'ajout du document pour la catégorie '${categoryKey}' (${item.title}):`, e);
                            errorCount++;
                        }
                    }
                }
            }
            console.log(`Importation terminée. Succès: ${successCount}, Erreurs: ${errorCount}.`);
            console.log("Vérifiez votre console Firebase (Firestore Database -> collection 'resources') pour voir les données.");
        }

        // Décommentez la ligne ci-dessous si vous souhaitez importer vos données initiales dans Firestore.
        // N'oubliez pas de la commenter à nouveau après la première exécution pour éviter les doublons.
        // importDataToFirestore(); 
    </script>
</body>
</html>
